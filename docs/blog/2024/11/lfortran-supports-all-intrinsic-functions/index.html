<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138613977-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-138613977-1');
</script>


  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>LFortran supports all intrinsic functions - </title>

  <meta name="description" content="We are thrilled to announce that LFortran supports all intrinsic functions
listed in F2018 Interpretation Document (Table 16.1 Pg: 332) (also shown by this nice list online at GFortran&rsquo;s documentation).
This comprehensive list of almost 200 intrinsics encompasses a broad array of
functions and subroutines essential to Fortran&rsquo;s functionality, including
elemental, inquiry, transformational, array operations, and more. For each
function we support both compile-time and runtime evaluation.
The functions are implemented in an ASR (Abstract Semantic Representation)
pass, which means they get &ldquo;instantiated&rdquo; and specialized for the argument
types and then the compiler can optimize it, so using any intrinsic function is
at least as fast as implementing the same operation yourself, there is no
runtime overhead."><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "LFortran",
    
    "url": "https:\/\/lfortran.org\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/lfortran.org\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/lfortran.org\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/lfortran.org\/blog\/2024\/11\/lfortran-supports-all-intrinsic-functions\/",
          "name": "Lfortran supports all intrinsic functions"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "[Harshita Kalani](https:\/\/github.com\/HarshitaKalani), [Parth Mistry](https:\/\/www.linkedin.com\/in\/parth-mistry-86b884229\/), [Pranav Goswami](https:\/\/www.linkedin.com\/in\/pranavgoswami1\/), [Gaurav Dhingra](https:\/\/github.com\/gxyd), [Assem Medhat](https:\/\/github.com\/assem2002), [Saurabh Kumar](https:\/\/github.com\/kmr-srbh), [Jinang Shah](https:\/\/github.com\/jinangshah21), [Aditya Trivedi](https:\/\/github.com\/adit4443ya), [Ansh Mehta](https:\/\/github.com\/AnshMehta1), [Gagandeep Singh](https:\/\/github.com\/czgdp1807), [Ubaid Shaikh](https:\/\/github.com\/Shaikh-Ubaid), [Thirumalai Shaktivel](https:\/\/www.linkedin.com\/in\/thirumalai-shaktivel\/), [Vipul Cariappa](https:\/\/github.com\/Vipul-Cariappa), [Shivi Mathur](https:\/\/github.com\/shivimathur), [Kerim Birgi](https:\/\/github.com\/KGB99), [Serge Sans Paille](https:\/\/github.com\/serge-sans-paille), [Advik Kabra](https:\/\/github.com\/advikkabra), [Brian Beckman](https:\/\/www.linkedin.com\/in\/brianbeckman), [Dylon Edwards](https:\/\/www.linkedin.com\/in\/dylon-edwards-0936bb39\/), [Naman Gera](https:\/\/uk.linkedin.com\/in\/namannimmo), [Rohit Goswami](https:\/\/gitlab.com\/HaoZeke), [Dominic Poerio](https:\/\/github.com\/dpoerio), [Akshānsh Bhatt](https:\/\/github.com\/akshanshbhatt), [Virendra Kabra](https:\/\/www.linkedin.com\/in\/virendrakabra\/), [Anutosh Bhat](https:\/\/github.com\/anutosh491), [Luthfan Lubis](https:\/\/github.com\/ansharlubis), [Zihua Wu](https:\/\/github.com\/lucifer1004), [Khushi Agrawal](https:\/\/khushi-411.github.io\/), [Christoph Junghans](https:\/\/github.com\/junghans), [Tanay Manerikar](https:\/\/github.com\/tanay-man), [Wolf Vollprecht](https:\/\/github.com\/wolfv), [Smit Lunagariya](https:\/\/www.linkedin.com\/in\/smit-lunagariya-356b93179\/), [Paul Henning](https:\/\/github.com\/pjh40), [Ondřej Čertík](https:\/\/ondrejcertik.com\/)"
  },
  "headline": "LFortran supports all intrinsic functions",
  "description" : "We are thrilled to announce that LFortran supports all intrinsic functions listed in F2018 Interpretation Document (Table 16.1 Pg: 332) (also shown by this nice list online at GFortran\u0026rsquo;s documentation). This comprehensive list of almost 200 intrinsics encompasses a broad array of functions and subroutines essential to Fortran\u0026rsquo;s functionality, including elemental, inquiry, transformational, array operations, and more. For each function we support both compile-time and runtime evaluation.\nThe functions are implemented in an ASR (Abstract Semantic Representation) pass, which means they get \u0026ldquo;instantiated\u0026rdquo; and specialized for the argument types and then the compiler can optimize it, so using any intrinsic function is at least as fast as implementing the same operation yourself, there is no runtime overhead.\n",
  "inLanguage" : "en",
  "wordCount":  2768 ,
  "datePublished" : "2024-11-14T00:00:00\u002b00:00",
  "dateModified" : "2024-11-14T00:00:00\u002b00:00",
  "image" : "https:\/\/lfortran.org\/",
  "keywords" : [ "Fortran, Announcement, IntrinsicFunctions, fortran-lang" ],
  "mainEntityOfPage" : "https:\/\/lfortran.org\/blog\/2024\/11\/lfortran-supports-all-intrinsic-functions\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/lfortran.org\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/lfortran.org\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="LFortran supports all intrinsic functions" />
<meta property="og:description" content="We are thrilled to announce that LFortran supports all intrinsic functions
listed in F2018 Interpretation Document (Table 16.1 Pg: 332) (also shown by this nice list online at GFortran&rsquo;s documentation).
This comprehensive list of almost 200 intrinsics encompasses a broad array of
functions and subroutines essential to Fortran&rsquo;s functionality, including
elemental, inquiry, transformational, array operations, and more. For each
function we support both compile-time and runtime evaluation.
The functions are implemented in an ASR (Abstract Semantic Representation)
pass, which means they get &ldquo;instantiated&rdquo; and specialized for the argument
types and then the compiler can optimize it, so using any intrinsic function is
at least as fast as implementing the same operation yourself, there is no
runtime overhead.">
<meta property="og:url" content="https://lfortran.org/blog/2024/11/lfortran-supports-all-intrinsic-functions/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="LFortran" />

  <meta name="twitter:title" content="LFortran supports all intrinsic functions" />
  <meta name="twitter:description" content="We are thrilled to announce that LFortran supports all intrinsic functions
listed in F2018 Interpretation Document (Table 16.1 Pg: 332) (also shown by this nice list online at GFortran&rsquo;s …">
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="generator" content="Hugo 0.138.0">
  <link rel="alternate" href="https://lfortran.org/index.xml" type="application/rss+xml" title="LFortran"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://lfortran.org/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://lfortran.org/css/syntax.css" /><link rel="stylesheet" href="https://lfortran.org/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">





<style>
h2 {
    font-size: 20px;
}
p, li {
    text-align: justify;
}
img {
    display: inline;
}
h1.h1heading {
    text-align: center;
}
h2.h2heading {
    text-align: center;
    font-size: 20px;
    font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-weight: 300;
    margin: 0 0 0;
}
#benefit i {
    margin-right: 20px;
}
#benefit {
    padding-left: 30px;
    padding-right: 30px;
}
#benefits {
    margin-top: 30px;
    margin-bottom: 50px;
}
.post-heading .post-meta a {
  color: #008AFF;
}
.post-heading .post-meta a:hover, a:focus {
  color: #0085a1;
  text-decoration: underline;
}

[data-toggle="collapse"].collapsed .if-not-collapsed {
  display: none;
}
[data-toggle="collapse"]:not(.collapsed) .if-collapsed {
  display: none;
}
</style>

  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://lfortran.org/">LFortran</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Download" href="/download/">Download</a>
            </li>
          
        
          
            <li>
              <a title="Documentation" href="https://docs.lfortran.org/">Documentation</a>
            </li>
          
        
          
            <li>
              <a title="Blog" href="/blog/">Blog</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>LFortran supports all intrinsic functions</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on November 14, 2024
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;13&nbsp;minutes
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;2768&nbsp;words
  
  
    &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;<a href="https://github.com/HarshitaKalani">Harshita Kalani</a>, <a href="https://www.linkedin.com/in/parth-mistry-86b884229/">Parth Mistry</a>, <a href="https://www.linkedin.com/in/pranavgoswami1/">Pranav Goswami</a>, <a href="https://github.com/gxyd">Gaurav Dhingra</a>, <a href="https://github.com/assem2002">Assem Medhat</a>, <a href="https://github.com/kmr-srbh">Saurabh Kumar</a>, <a href="https://github.com/jinangshah21">Jinang Shah</a>, <a href="https://github.com/adit4443ya">Aditya Trivedi</a>, <a href="https://github.com/AnshMehta1">Ansh Mehta</a>, <a href="https://github.com/czgdp1807">Gagandeep Singh</a>, <a href="https://github.com/Shaikh-Ubaid">Ubaid Shaikh</a>, <a href="https://www.linkedin.com/in/thirumalai-shaktivel/">Thirumalai Shaktivel</a>, <a href="https://github.com/Vipul-Cariappa">Vipul Cariappa</a>, <a href="https://github.com/shivimathur">Shivi Mathur</a>, <a href="https://github.com/KGB99">Kerim Birgi</a>, <a href="https://github.com/serge-sans-paille">Serge Sans Paille</a>, <a href="https://github.com/advikkabra">Advik Kabra</a>, <a href="https://www.linkedin.com/in/brianbeckman">Brian Beckman</a>, <a href="https://www.linkedin.com/in/dylon-edwards-0936bb39/">Dylon Edwards</a>, <a href="https://uk.linkedin.com/in/namannimmo">Naman Gera</a>, <a href="https://gitlab.com/HaoZeke">Rohit Goswami</a>, <a href="https://github.com/dpoerio">Dominic Poerio</a>, <a href="https://github.com/akshanshbhatt">Akshānsh Bhatt</a>, <a href="https://www.linkedin.com/in/virendrakabra/">Virendra Kabra</a>, <a href="https://github.com/anutosh491">Anutosh Bhat</a>, <a href="https://github.com/ansharlubis">Luthfan Lubis</a>, <a href="https://github.com/lucifer1004">Zihua Wu</a>, <a href="https://khushi-411.github.io/">Khushi Agrawal</a>, <a href="https://github.com/junghans">Christoph Junghans</a>, <a href="https://github.com/tanay-man">Tanay Manerikar</a>, <a href="https://github.com/wolfv">Wolf Vollprecht</a>, <a href="https://www.linkedin.com/in/smit-lunagariya-356b93179/">Smit Lunagariya</a>, <a href="https://github.com/pjh40">Paul Henning</a>, <a href="https://ondrejcertik.com/">Ondřej Čertík</a>
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>We are thrilled to announce that LFortran supports all intrinsic functions
listed in <a href="https://j3-fortran.org/doc/year/18/18-007r1.pdf">F2018 Interpretation Document (Table 16.1 Pg: 332)</a> (also shown by this nice <a href="https://gcc.gnu.org/onlinedocs/gfortran/Intrinsic-Procedures.html">list</a> online at GFortran&rsquo;s documentation).
This comprehensive list of almost 200 intrinsics encompasses a broad array of
functions and subroutines essential to Fortran&rsquo;s functionality, including
elemental, inquiry, transformational, array operations, and more. For each
function we support both compile-time and runtime evaluation.</p>
<p>The functions are implemented in an ASR (Abstract Semantic Representation)
pass, which means they get &ldquo;instantiated&rdquo; and specialized for the argument
types and then the compiler can optimize it, so using any intrinsic function is
at least as fast as implementing the same operation yourself, there is no
runtime overhead.</p>
<p>In this blog post we show the details how things are implemented under the
hood, and if you find it interesting, go ahead and try it yourself in LFortran
and let us know any feedback.</p>
<p>LFortran is still alpha software, meaning that users must continue expecting that LFortran will fail compiling or running their codes. Please report all bugs that you find.</p>
<p>LFortran’s implementation of all intrinsic functions has been instrumental in
reaching its current milestone, where it can successfully compile 7 out of 10
essential third-party projects required for its beta phase. These projects,
including dftatom, SNAP, SciPy, stdlib, and fastGPT, heavily rely on Fortran&rsquo;s
built-in operations to perform a range of computational tasks, from
mathematical computations to array handling and logical operations.</p>
<h2 id="design-of-intrinsic-functions">Design of intrinsic functions</h2>
<p>In earlier versions, LFortran implemented intrinsic functions via intrinsic
modules written in Fortran in the runtime library. The implementation was thus
available to the compiler at the ASR level, guaranteeing no runtime overhead,
and the implementation was in Fortran, thus any Fortran programmer could
participate on the implementation.
However it had three major issues:</p>
<ul>
<li>We had to implement a specific version of each function for all argument
types and ranks, so for example the function <code>sum</code> must work for <code>integer</code>,
<code>real</code>, <code>complex</code> types each with at least two kinds (at least 6 total), and
ranks 1-15, so around 100 functions total, with special handling of <code>dim</code> for
each.</li>
<li>Impossible to specialize the implementation based on the arguments (e.g., <code>sum</code>
with the <code>dim</code> argument requires a special loop structure for each <code>dim</code>
which should be specialized for highest performance).</li>
<li>The compiler just saw an ASR function implementation (such as <code>sin</code>), and we
marked the module as &ldquo;intrinsic&rdquo;, but it was hard to create ASR passes to add
special optimizations for particular intrinsics, since we didn&rsquo;t have
dedicated nodes for them.</li>
</ul>
<p>To fix these problems, we now represent intrinsics directly as nodes in ASR.
This allows all of the compiler to have knowledge about them and can optimize
them, create better error messages, backends can have special handling for
them, etc. Then we have an ASR pass that instantiates these nodes for the
particular arguments in ASR itself, providing the highest performance. This
design allows us to later for example not instantiate some intrinsics, but let
the backend generate a special hardware instruction (say for inverse square
root).</p>
<p>For instance, consider the max function and the following program.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fortran" data-lang="fortran"><span style="display:flex;"><span><span style="color:#66d9ef">program</span> main
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">integer</span> <span style="color:#66d9ef">::</span> a, b
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">read</span> <span style="color:#f92672">*</span>, a, b
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">print</span> <span style="color:#f92672">*</span>, max(a, b)
</span></span><span style="display:flex;"><span> <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">program</span>
</span></span></code></pre></div><p>The AST (Abstract Syntax Tree) just represents <code>max</code> as a <code>FuncCallOrArray</code> AST
node (it does not even know if it is an array or a function call due to
Fortran&rsquo;s syntax ambiguity):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-clj" data-lang="clj"><span style="display:flex;"><span>(<span style="color:#a6e22e">TranslationUnit</span>
</span></span><span style="display:flex;"><span>   [(<span style="color:#a6e22e">Program</span>
</span></span><span style="display:flex;"><span>       main
</span></span><span style="display:flex;"><span>       (<span style="color:#a6e22e">TriviaNode</span>
</span></span><span style="display:flex;"><span>           []
</span></span><span style="display:flex;"><span>           [(<span style="color:#a6e22e">EndOfLine</span>)
</span></span><span style="display:flex;"><span>           (<span style="color:#a6e22e">EndOfLine</span>)]
</span></span><span style="display:flex;"><span>       )
</span></span><span style="display:flex;"><span>       []
</span></span><span style="display:flex;"><span>       []
</span></span><span style="display:flex;"><span>       [(<span style="color:#a6e22e">Declaration</span>
</span></span><span style="display:flex;"><span>           (<span style="color:#a6e22e">AttrType</span>
</span></span><span style="display:flex;"><span>               TypeInteger
</span></span><span style="display:flex;"><span>               []
</span></span><span style="display:flex;"><span>               ()
</span></span><span style="display:flex;"><span>               ()
</span></span><span style="display:flex;"><span>               None
</span></span><span style="display:flex;"><span>           )
</span></span><span style="display:flex;"><span>           []
</span></span><span style="display:flex;"><span>           [(<span style="color:#a6e22e">a</span>
</span></span><span style="display:flex;"><span>           []
</span></span><span style="display:flex;"><span>           []
</span></span><span style="display:flex;"><span>           ()
</span></span><span style="display:flex;"><span>           ()
</span></span><span style="display:flex;"><span>           None
</span></span><span style="display:flex;"><span>           ())
</span></span><span style="display:flex;"><span>           (<span style="color:#a6e22e">b</span>
</span></span><span style="display:flex;"><span>           []
</span></span><span style="display:flex;"><span>           []
</span></span><span style="display:flex;"><span>           ()
</span></span><span style="display:flex;"><span>           ()
</span></span><span style="display:flex;"><span>           None
</span></span><span style="display:flex;"><span>           ())]
</span></span><span style="display:flex;"><span>           ()
</span></span><span style="display:flex;"><span>       )]
</span></span><span style="display:flex;"><span>       [(<span style="color:#a6e22e">Read</span>
</span></span><span style="display:flex;"><span>           <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>           ()
</span></span><span style="display:flex;"><span>           []
</span></span><span style="display:flex;"><span>           []
</span></span><span style="display:flex;"><span>           [a
</span></span><span style="display:flex;"><span>           b]
</span></span><span style="display:flex;"><span>           ()
</span></span><span style="display:flex;"><span>       )
</span></span><span style="display:flex;"><span>       (<span style="color:#a6e22e">Print</span>
</span></span><span style="display:flex;"><span>           <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>           ()
</span></span><span style="display:flex;"><span>           [(<span style="color:#a6e22e">FuncCallOrArray</span>
</span></span><span style="display:flex;"><span>               max
</span></span><span style="display:flex;"><span>               []
</span></span><span style="display:flex;"><span>               [(()
</span></span><span style="display:flex;"><span>               a
</span></span><span style="display:flex;"><span>               ()
</span></span><span style="display:flex;"><span>               <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>               (()
</span></span><span style="display:flex;"><span>               b
</span></span><span style="display:flex;"><span>               ()
</span></span><span style="display:flex;"><span>               <span style="color:#ae81ff">0</span>)]
</span></span><span style="display:flex;"><span>               []
</span></span><span style="display:flex;"><span>               []
</span></span><span style="display:flex;"><span>               []
</span></span><span style="display:flex;"><span>           )]
</span></span><span style="display:flex;"><span>           ()
</span></span><span style="display:flex;"><span>       )]
</span></span><span style="display:flex;"><span>       []
</span></span><span style="display:flex;"><span>   )]
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>In ASR (Abstract Semantic Representation) on the other hand <code>max</code> is
represented as <code>IntrinsicElementalFunction</code> and the compiler knows everything
about it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-clj" data-lang="clj"><span style="display:flex;"><span>(<span style="color:#a6e22e">TranslationUnit</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">SymbolTable</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            main<span style="color:#960050;background-color:#1e0010">:</span>
</span></span><span style="display:flex;"><span>                (<span style="color:#a6e22e">Program</span>
</span></span><span style="display:flex;"><span>                    (<span style="color:#a6e22e">SymbolTable</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>                        {
</span></span><span style="display:flex;"><span>                            a<span style="color:#960050;background-color:#1e0010">:</span>
</span></span><span style="display:flex;"><span>                                (<span style="color:#a6e22e">Variable</span>
</span></span><span style="display:flex;"><span>                                    <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>                                    a
</span></span><span style="display:flex;"><span>                                    []
</span></span><span style="display:flex;"><span>                                    Local
</span></span><span style="display:flex;"><span>                                    ()
</span></span><span style="display:flex;"><span>                                    ()
</span></span><span style="display:flex;"><span>                                    Default
</span></span><span style="display:flex;"><span>                                    (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                                    ()
</span></span><span style="display:flex;"><span>                                    Source
</span></span><span style="display:flex;"><span>                                    Public
</span></span><span style="display:flex;"><span>                                    Required
</span></span><span style="display:flex;"><span>                                    .false.
</span></span><span style="display:flex;"><span>                                ),
</span></span><span style="display:flex;"><span>                            b<span style="color:#960050;background-color:#1e0010">:</span>
</span></span><span style="display:flex;"><span>                                (<span style="color:#a6e22e">Variable</span>
</span></span><span style="display:flex;"><span>                                    <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>                                    b
</span></span><span style="display:flex;"><span>                                    []
</span></span><span style="display:flex;"><span>                                    Local
</span></span><span style="display:flex;"><span>                                    ()
</span></span><span style="display:flex;"><span>                                    ()
</span></span><span style="display:flex;"><span>                                    Default
</span></span><span style="display:flex;"><span>                                    (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                                    ()
</span></span><span style="display:flex;"><span>                                    Source
</span></span><span style="display:flex;"><span>                                    Public
</span></span><span style="display:flex;"><span>                                    Required
</span></span><span style="display:flex;"><span>                                    .false.
</span></span><span style="display:flex;"><span>                                )
</span></span><span style="display:flex;"><span>                        })
</span></span><span style="display:flex;"><span>                    main
</span></span><span style="display:flex;"><span>                    []
</span></span><span style="display:flex;"><span>                    [(<span style="color:#a6e22e">FileRead</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                        ()
</span></span><span style="display:flex;"><span>                        ()
</span></span><span style="display:flex;"><span>                        ()
</span></span><span style="display:flex;"><span>                        ()
</span></span><span style="display:flex;"><span>                        ()
</span></span><span style="display:flex;"><span>                        ()
</span></span><span style="display:flex;"><span>                        [(<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">2</span> a)
</span></span><span style="display:flex;"><span>                        (<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">2</span> b)]
</span></span><span style="display:flex;"><span>                        ()
</span></span><span style="display:flex;"><span>                    )
</span></span><span style="display:flex;"><span>                    (<span style="color:#a6e22e">Print</span>
</span></span><span style="display:flex;"><span>                        (<span style="color:#a6e22e">StringFormat</span>
</span></span><span style="display:flex;"><span>                            ()
</span></span><span style="display:flex;"><span>                            [(<span style="color:#a6e22e">IntrinsicElementalFunction</span>
</span></span><span style="display:flex;"><span>                                Max
</span></span><span style="display:flex;"><span>                                [(<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">2</span> a)
</span></span><span style="display:flex;"><span>                                (<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">2</span> b)]
</span></span><span style="display:flex;"><span>                                <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                                (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                                ()
</span></span><span style="display:flex;"><span>                            )]
</span></span><span style="display:flex;"><span>                            FormatFortran
</span></span><span style="display:flex;"><span>                            (<span style="color:#a6e22e">Character</span> <span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">0</span> () PointerString)
</span></span><span style="display:flex;"><span>                            ()
</span></span><span style="display:flex;"><span>                        )
</span></span><span style="display:flex;"><span>                    )]
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    []
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>Initially represented as a <code>FuncCallOrArray</code> node in the frontend, it is then identified as an elemental intrinsic function and converted to a dedicated <code>IntrinsicElementalFunction</code> node. As the code progresses through the intrinsic functions ASR pass (implemented in <code>intrinsic_functions.cpp</code>), this node is replaced by an ASR function (<code>_lcompilers_max0_i32</code>) that is constructed and cached on the fly, based on the function’s arguments as shown in ASR below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-clj" data-lang="clj"><span style="display:flex;"><span>(<span style="color:#a6e22e">Function</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">SymbolTable</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            _lcompilers_max0_i32<span style="color:#960050;background-color:#1e0010">:</span>
</span></span><span style="display:flex;"><span>                (<span style="color:#a6e22e">Variable</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>                    _lcompilers_max0_i32
</span></span><span style="display:flex;"><span>                    []
</span></span><span style="display:flex;"><span>                    ReturnVar
</span></span><span style="display:flex;"><span>                    ()
</span></span><span style="display:flex;"><span>                    ()
</span></span><span style="display:flex;"><span>                    Default
</span></span><span style="display:flex;"><span>                    (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                    ()
</span></span><span style="display:flex;"><span>                    Source
</span></span><span style="display:flex;"><span>                    Public
</span></span><span style="display:flex;"><span>                    Required
</span></span><span style="display:flex;"><span>                    .false.
</span></span><span style="display:flex;"><span>                ),
</span></span><span style="display:flex;"><span>            x0<span style="color:#960050;background-color:#1e0010">:</span>
</span></span><span style="display:flex;"><span>                (<span style="color:#a6e22e">Variable</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>                    x0
</span></span><span style="display:flex;"><span>                    []
</span></span><span style="display:flex;"><span>                    In
</span></span><span style="display:flex;"><span>                    ()
</span></span><span style="display:flex;"><span>                    ()
</span></span><span style="display:flex;"><span>                    Default
</span></span><span style="display:flex;"><span>                    (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                    ()
</span></span><span style="display:flex;"><span>                    Source
</span></span><span style="display:flex;"><span>                    Public
</span></span><span style="display:flex;"><span>                    Required
</span></span><span style="display:flex;"><span>                    .false.
</span></span><span style="display:flex;"><span>                ),
</span></span><span style="display:flex;"><span>            x1<span style="color:#960050;background-color:#1e0010">:</span>
</span></span><span style="display:flex;"><span>                (<span style="color:#a6e22e">Variable</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>                    x1
</span></span><span style="display:flex;"><span>                    []
</span></span><span style="display:flex;"><span>                    In
</span></span><span style="display:flex;"><span>                    ()
</span></span><span style="display:flex;"><span>                    ()
</span></span><span style="display:flex;"><span>                    Default
</span></span><span style="display:flex;"><span>                    (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                    ()
</span></span><span style="display:flex;"><span>                    Source
</span></span><span style="display:flex;"><span>                    Public
</span></span><span style="display:flex;"><span>                    Required
</span></span><span style="display:flex;"><span>                    .false.
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    _lcompilers_max0_i32
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">FunctionType</span>
</span></span><span style="display:flex;"><span>        [(<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>        (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)]
</span></span><span style="display:flex;"><span>        (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>        Source
</span></span><span style="display:flex;"><span>        Implementation
</span></span><span style="display:flex;"><span>        ()
</span></span><span style="display:flex;"><span>        .false.
</span></span><span style="display:flex;"><span>        .false.
</span></span><span style="display:flex;"><span>        .false.
</span></span><span style="display:flex;"><span>        .false.
</span></span><span style="display:flex;"><span>        .false.
</span></span><span style="display:flex;"><span>        []
</span></span><span style="display:flex;"><span>        .false.
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    []
</span></span><span style="display:flex;"><span>    [(<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">3</span> x0)
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">3</span> x1)]
</span></span><span style="display:flex;"><span>    [(<span style="color:#a6e22e">Assignment</span>
</span></span><span style="display:flex;"><span>        (<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">3</span> _lcompilers_max0_i32)
</span></span><span style="display:flex;"><span>        (<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">3</span> x0)
</span></span><span style="display:flex;"><span>        ()
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">If</span>
</span></span><span style="display:flex;"><span>        (<span style="color:#a6e22e">IntegerCompare</span>
</span></span><span style="display:flex;"><span>            (<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">3</span> x1)
</span></span><span style="display:flex;"><span>            Gt
</span></span><span style="display:flex;"><span>            (<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">3</span> _lcompilers_max0_i32)
</span></span><span style="display:flex;"><span>            (<span style="color:#a6e22e">Logical</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>            ()
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        [(<span style="color:#a6e22e">Assignment</span>
</span></span><span style="display:flex;"><span>            (<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">3</span> _lcompilers_max0_i32)
</span></span><span style="display:flex;"><span>            (<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">3</span> x1)
</span></span><span style="display:flex;"><span>            ()
</span></span><span style="display:flex;"><span>        )]
</span></span><span style="display:flex;"><span>        []
</span></span><span style="display:flex;"><span>    )]
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">3</span> _lcompilers_max0_i32)
</span></span><span style="display:flex;"><span>    Public
</span></span><span style="display:flex;"><span>    .false.
</span></span><span style="display:flex;"><span>    .false.
</span></span><span style="display:flex;"><span>    ()
</span></span><span style="display:flex;"><span>),
</span></span></code></pre></div><p>And the <code>IntrinsicElementalFunction</code> node is replaced by corresponding function call to the newly created ASR function:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-clj" data-lang="clj"><span style="display:flex;"><span>(<span style="color:#a6e22e">Print</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">StringFormat</span>
</span></span><span style="display:flex;"><span>        ()
</span></span><span style="display:flex;"><span>        [(<span style="color:#a6e22e">FunctionCall</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">1</span> _lcompilers_max0_i32
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">1</span> _lcompilers_max0_i32
</span></span><span style="display:flex;"><span>            [((<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">2</span> a))
</span></span><span style="display:flex;"><span>            ((<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">2</span> b))]
</span></span><span style="display:flex;"><span>            (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>            ()
</span></span><span style="display:flex;"><span>            ()
</span></span><span style="display:flex;"><span>        )]
</span></span><span style="display:flex;"><span>        FormatFortran
</span></span><span style="display:flex;"><span>        (<span style="color:#a6e22e">Character</span> <span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">0</span> () PointerString)
</span></span><span style="display:flex;"><span>        ()
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>To understand it better, we can print the ASR as Fortran code using <code>lfortran a.f90 --dump-all-passes-fortran</code> and we get:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fortran" data-lang="fortran"><span style="display:flex;"><span><span style="color:#75715e">! Fortran code after applying the pass: intrinsic_function
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">program</span> main
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">none</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>) <span style="color:#66d9ef">::</span> a
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>) <span style="color:#66d9ef">::</span> b
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">read</span>(<span style="color:#f92672">*</span>, <span style="color:#f92672">*</span>) a, b
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">print</span> <span style="color:#f92672">*</span>, <span style="color:#960050;background-color:#1e0010">_</span>lcompilers_max0_i32(a, b)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">contains</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>) <span style="color:#66d9ef">function</span> <span style="color:#960050;background-color:#1e0010">_</span>lcompilers_max0_i32(x0, x1)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>), <span style="color:#66d9ef">intent</span>(in) <span style="color:#66d9ef">::</span> x0
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>), <span style="color:#66d9ef">intent</span>(in) <span style="color:#66d9ef">::</span> x1
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">_</span>lcompilers_max0_i32 <span style="color:#f92672">=</span> x0
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (x1 <span style="color:#f92672">&gt;</span> <span style="color:#960050;background-color:#1e0010">_</span>lcompilers_max0_i32) <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#960050;background-color:#1e0010">_</span>lcompilers_max0_i32 <span style="color:#f92672">=</span> x1
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">if</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span> <span style="color:#66d9ef">function</span> <span style="color:#960050;background-color:#1e0010">_</span>lcompilers_max0_i32
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span> <span style="color:#66d9ef">program</span> main
</span></span></code></pre></div><p>The ASR-&gt;LLVM backend then takes this code and generates LLVM. By default (Debug mode) it is not optimized:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-llvm" data-lang="llvm"><span style="display:flex;"><span><span style="color:#75715e">; ModuleID = &#39;LFortran&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">source_filename</span> = <span style="color:#e6db74">&#34;LFortran&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@0 = <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">unnamed_addr</span> <span style="color:#66d9ef">constant</span> [<span style="color:#ae81ff">2</span> <span style="color:#66d9ef">x</span> <span style="color:#66d9ef">i8</span>] <span style="color:#66d9ef">c</span><span style="color:#e6db74">&#34;\0A\00&#34;</span>, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>@1 = <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">unnamed_addr</span> <span style="color:#66d9ef">constant</span> [<span style="color:#ae81ff">5</span> <span style="color:#66d9ef">x</span> <span style="color:#66d9ef">i8</span>] <span style="color:#66d9ef">c</span><span style="color:#e6db74">&#34;%s%s\00&#34;</span>, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">define</span> <span style="color:#66d9ef">i32</span> @_lcompilers_max0_i32(<span style="color:#66d9ef">i32</span>* %x0, <span style="color:#66d9ef">i32</span>* %x1) {
</span></span><span style="display:flex;"><span>.entry:
</span></span><span style="display:flex;"><span>  %_lcompilers_max0_i32 = <span style="color:#66d9ef">alloca</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  %0 = <span style="color:#66d9ef">load</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i32</span>* %x0, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">store</span> <span style="color:#66d9ef">i32</span> %0, <span style="color:#66d9ef">i32</span>* %_lcompilers_max0_i32, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  %1 = <span style="color:#66d9ef">load</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i32</span>* %x1, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  %2 = <span style="color:#66d9ef">load</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i32</span>* %_lcompilers_max0_i32, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  %3 = <span style="color:#66d9ef">icmp</span> <span style="color:#66d9ef">sgt</span> <span style="color:#66d9ef">i32</span> %1, %2
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">br</span> <span style="color:#66d9ef">i1</span> %3, <span style="color:#66d9ef">label</span> %then, <span style="color:#66d9ef">label</span> %else
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>then:                                             <span style="color:#75715e">; preds = %.entry
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  %4 = <span style="color:#66d9ef">load</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i32</span>* %x1, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">store</span> <span style="color:#66d9ef">i32</span> %4, <span style="color:#66d9ef">i32</span>* %_lcompilers_max0_i32, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">br</span> <span style="color:#66d9ef">label</span> %ifcont
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>else:                                             <span style="color:#75715e">; preds = %.entry
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">br</span> <span style="color:#66d9ef">label</span> %ifcont
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ifcont:                                           <span style="color:#75715e">; preds = %else, %then
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">br</span> <span style="color:#66d9ef">label</span> %return
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>return:                                           <span style="color:#75715e">; preds = %ifcont
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  %5 = <span style="color:#66d9ef">load</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i32</span>* %_lcompilers_max0_i32, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ret</span> <span style="color:#66d9ef">i32</span> %5
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">define</span> <span style="color:#66d9ef">i32</span> @main(<span style="color:#66d9ef">i32</span> %0, <span style="color:#66d9ef">i8</span>** %1) {
</span></span><span style="display:flex;"><span>.entry:
</span></span><span style="display:flex;"><span>  %a = <span style="color:#66d9ef">alloca</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  %b = <span style="color:#66d9ef">alloca</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">void</span> @_lpython_call_initial_functions(<span style="color:#66d9ef">i32</span> %0, <span style="color:#66d9ef">i8</span>** %1)
</span></span><span style="display:flex;"><span>  %a1 = <span style="color:#66d9ef">alloca</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  %b2 = <span style="color:#66d9ef">alloca</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  %2 = <span style="color:#66d9ef">alloca</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  %3 = <span style="color:#66d9ef">alloca</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">void</span> @_lfortran_read_int32(<span style="color:#66d9ef">i32</span>* %a1, <span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">-1</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">void</span> @_lfortran_read_int32(<span style="color:#66d9ef">i32</span>* %b2, <span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">-1</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">void</span> @_lfortran_empty_read(<span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">-1</span>, <span style="color:#66d9ef">i32</span>* %2)
</span></span><span style="display:flex;"><span>  %4 = <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">i32</span> @_lcompilers_max0_i32(<span style="color:#66d9ef">i32</span>* %a1, <span style="color:#66d9ef">i32</span>* %b2)
</span></span><span style="display:flex;"><span>  %5 = <span style="color:#66d9ef">sext</span> <span style="color:#66d9ef">i32</span> %4 <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">i64</span>
</span></span><span style="display:flex;"><span>  %6 = <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">i8</span>* (<span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i8</span>*, ...) @_lcompilers_string_format_fortran(<span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">2</span>, <span style="color:#66d9ef">i8</span>* <span style="color:#66d9ef">null</span>, <span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">2</span>, <span style="color:#66d9ef">i64</span> %5)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">void</span> (<span style="color:#66d9ef">i8</span>*, ...) @_lfortran_printf(<span style="color:#66d9ef">i8</span>* <span style="color:#66d9ef">getelementptr</span> <span style="color:#66d9ef">inbounds</span> ([<span style="color:#ae81ff">5</span> <span style="color:#66d9ef">x</span> <span style="color:#66d9ef">i8</span>], [<span style="color:#ae81ff">5</span> <span style="color:#66d9ef">x</span> <span style="color:#66d9ef">i8</span>]* @1, <span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">0</span>), <span style="color:#66d9ef">i8</span>* %6, <span style="color:#66d9ef">i8</span>* <span style="color:#66d9ef">getelementptr</span> <span style="color:#66d9ef">inbounds</span> ([<span style="color:#ae81ff">2</span> <span style="color:#66d9ef">x</span> <span style="color:#66d9ef">i8</span>], [<span style="color:#ae81ff">2</span> <span style="color:#66d9ef">x</span> <span style="color:#66d9ef">i8</span>]* @0, <span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">br</span> <span style="color:#66d9ef">label</span> %return
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>return:                                           <span style="color:#75715e">; preds = %.entry
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">ret</span> <span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">declare</span> <span style="color:#66d9ef">void</span> @_lpython_call_initial_functions(<span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i8</span>**)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">declare</span> <span style="color:#66d9ef">void</span> @_lfortran_read_int32(<span style="color:#66d9ef">i32</span>*, <span style="color:#66d9ef">i32</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">declare</span> <span style="color:#66d9ef">void</span> @_lfortran_empty_read(<span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i32</span>*)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">declare</span> <span style="color:#66d9ef">i8</span>* @_lcompilers_string_format_fortran(<span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i8</span>*, ...)
</span></span></code></pre></div><p>It will call the &ldquo;instantiated&rdquo; <code>_lcompilers_max0_i32</code> function. It&rsquo;s not
slower than calling a pre-compiled <code>max</code> function from a runtime library (as is
often done in other compilers), but it is not the fastest possible
implementation. To obtain maximum
performance, we have to use Release mode by using the <code>--fast</code> flag in
LFortran. Currently we do not do many ASR-&gt;ASR optimizations (we will add many
such optimizations later after reaching beta quality), but it enables LLVM
optimizations and LLVM can optimize the above code to just:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-llvm" data-lang="llvm"><span style="display:flex;"><span><span style="color:#75715e">; ModuleID = &#39;LFortran&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">source_filename</span> = <span style="color:#e6db74">&#34;LFortran&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">target</span> <span style="color:#66d9ef">datalayout</span> = <span style="color:#e6db74">&#34;e-m:o-i64:64-i128:128-n32:64-S128&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">target</span> <span style="color:#66d9ef">triple</span> = <span style="color:#e6db74">&#34;arm64-apple-darwin23.3.0&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@0 = <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">unnamed_addr</span> <span style="color:#66d9ef">constant</span> [<span style="color:#ae81ff">2</span> <span style="color:#66d9ef">x</span> <span style="color:#66d9ef">i8</span>] <span style="color:#66d9ef">c</span><span style="color:#e6db74">&#34;\0A\00&#34;</span>, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>@1 = <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">unnamed_addr</span> <span style="color:#66d9ef">constant</span> [<span style="color:#ae81ff">5</span> <span style="color:#66d9ef">x</span> <span style="color:#66d9ef">i8</span>] <span style="color:#66d9ef">c</span><span style="color:#e6db74">&#34;%s%s\00&#34;</span>, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">; Function Attrs: norecurse nounwind readonly
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">define</span> <span style="color:#66d9ef">i32</span> @_lcompilers_max0_i32(<span style="color:#66d9ef">i32</span>* <span style="color:#66d9ef">nocapture</span> <span style="color:#66d9ef">readonly</span> %x0, <span style="color:#66d9ef">i32</span>* <span style="color:#66d9ef">nocapture</span> <span style="color:#66d9ef">readonly</span> %x1) <span style="color:#66d9ef">local_unnamed_addr</span> #0 {
</span></span><span style="display:flex;"><span>.entry:
</span></span><span style="display:flex;"><span>  %0 = <span style="color:#66d9ef">load</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i32</span>* %x0, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  %1 = <span style="color:#66d9ef">load</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i32</span>* %x1, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  %2 = <span style="color:#66d9ef">icmp</span> <span style="color:#66d9ef">sgt</span> <span style="color:#66d9ef">i32</span> %1, %0
</span></span><span style="display:flex;"><span>  %spec.select = <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">i1</span> %2, <span style="color:#66d9ef">i32</span> %1, <span style="color:#66d9ef">i32</span> %0
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ret</span> <span style="color:#66d9ef">i32</span> %spec.select
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">define</span> <span style="color:#66d9ef">i32</span> @main(<span style="color:#66d9ef">i32</span> %0, <span style="color:#66d9ef">i8</span>** %1) <span style="color:#66d9ef">local_unnamed_addr</span> {
</span></span><span style="display:flex;"><span>.entry:
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">tail</span> <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">void</span> @_lpython_call_initial_functions(<span style="color:#66d9ef">i32</span> %0, <span style="color:#66d9ef">i8</span>** %1)
</span></span><span style="display:flex;"><span>  %a1 = <span style="color:#66d9ef">alloca</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  %b2 = <span style="color:#66d9ef">alloca</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  %2 = <span style="color:#66d9ef">alloca</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">void</span> @_lfortran_read_int32(<span style="color:#66d9ef">i32</span>* <span style="color:#66d9ef">nonnull</span> %a1, <span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">-1</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">void</span> @_lfortran_read_int32(<span style="color:#66d9ef">i32</span>* <span style="color:#66d9ef">nonnull</span> %b2, <span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">-1</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">void</span> @_lfortran_empty_read(<span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">-1</span>, <span style="color:#66d9ef">i32</span>* <span style="color:#66d9ef">nonnull</span> %2)
</span></span><span style="display:flex;"><span>  %3 = <span style="color:#66d9ef">load</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i32</span>* %a1, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  %4 = <span style="color:#66d9ef">load</span> <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i32</span>* %b2, <span style="color:#66d9ef">align</span> <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>  %5 = <span style="color:#66d9ef">icmp</span> <span style="color:#66d9ef">sgt</span> <span style="color:#66d9ef">i32</span> %4, %3
</span></span><span style="display:flex;"><span>  %spec.select.i = <span style="color:#66d9ef">select</span> <span style="color:#66d9ef">i1</span> %5, <span style="color:#66d9ef">i32</span> %4, <span style="color:#66d9ef">i32</span> %3
</span></span><span style="display:flex;"><span>  %6 = <span style="color:#66d9ef">sext</span> <span style="color:#66d9ef">i32</span> %spec.select.i <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">i64</span>
</span></span><span style="display:flex;"><span>  %7 = <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">i8</span>* (<span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i8</span>*, ...) @_lcompilers_string_format_fortran(<span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">2</span>, <span style="color:#66d9ef">i8</span>* <span style="color:#66d9ef">null</span>, <span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">2</span>, <span style="color:#66d9ef">i64</span> %6)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">call</span> <span style="color:#66d9ef">void</span> (<span style="color:#66d9ef">i8</span>*, ...) @_lfortran_printf(<span style="color:#66d9ef">i8</span>* <span style="color:#66d9ef">getelementptr</span> <span style="color:#66d9ef">inbounds</span> ([<span style="color:#ae81ff">5</span> <span style="color:#66d9ef">x</span> <span style="color:#66d9ef">i8</span>], [<span style="color:#ae81ff">5</span> <span style="color:#66d9ef">x</span> <span style="color:#66d9ef">i8</span>]* @1, <span style="color:#66d9ef">i64</span> <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">i64</span> <span style="color:#ae81ff">0</span>), <span style="color:#66d9ef">i8</span>* %7, <span style="color:#66d9ef">i8</span>* <span style="color:#66d9ef">getelementptr</span> <span style="color:#66d9ef">inbounds</span> ([<span style="color:#ae81ff">2</span> <span style="color:#66d9ef">x</span> <span style="color:#66d9ef">i8</span>], [<span style="color:#ae81ff">2</span> <span style="color:#66d9ef">x</span> <span style="color:#66d9ef">i8</span>]* @0, <span style="color:#66d9ef">i64</span> <span style="color:#ae81ff">0</span>, <span style="color:#66d9ef">i64</span> <span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">ret</span> <span style="color:#66d9ef">i32</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">declare</span> <span style="color:#66d9ef">void</span> @_lpython_call_initial_functions(<span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i8</span>**) <span style="color:#66d9ef">local_unnamed_addr</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">declare</span> <span style="color:#66d9ef">void</span> @_lfortran_read_int32(<span style="color:#66d9ef">i32</span>*, <span style="color:#66d9ef">i32</span>) <span style="color:#66d9ef">local_unnamed_addr</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">declare</span> <span style="color:#66d9ef">void</span> @_lfortran_empty_read(<span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i32</span>*) <span style="color:#66d9ef">local_unnamed_addr</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">declare</span> <span style="color:#66d9ef">i8</span>* @_lcompilers_string_format_fortran(<span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i8</span>*, ...) <span style="color:#66d9ef">local_unnamed_addr</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">declare</span> <span style="color:#66d9ef">void</span> @_lfortran_printf(<span style="color:#66d9ef">i8</span>*, ...) <span style="color:#66d9ef">local_unnamed_addr</span>
</span></span></code></pre></div><p>As you can see, the function got inlined and simplified. The resulting code is as fast as you would get by manually implementing the logic. Conclusion: there is no runtime overhead by using intrinsic functions.</p>
<p>Let&rsquo;s take the example of another function, <code>sum</code>. Sum is an intrinsic array function with more number of arguments, out of which some are optional. Most of the intrinsic array functions and subroutines include optional arguments. They are handled with the help of <code>overload_id</code> in ASR. Let&rsquo;s look at the <code>dim</code> parameter in the <code>sum</code> intrinsic. In the <code>sum</code> function, the <code>FuncCallOrArray</code> node represented in the frontend is then recognised as an array intrinsic and is replaced with the <code>IntrinsicArrayFunction</code> node.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fortran" data-lang="fortran"><span style="display:flex;"><span><span style="color:#66d9ef">program</span> test_sum_dim
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">integer</span> <span style="color:#66d9ef">::</span> x(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>) <span style="color:#f92672">=</span> reshape([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>], [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">integer</span> <span style="color:#66d9ef">::</span> dim_ <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">print</span> <span style="color:#f92672">*</span>, sum(x, dim<span style="color:#f92672">=</span>dim_)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span> <span style="color:#66d9ef">program</span>
</span></span></code></pre></div><p>AST:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-clj" data-lang="clj"><span style="display:flex;"><span>(<span style="color:#a6e22e">TranslationUnit</span>
</span></span><span style="display:flex;"><span>    [(<span style="color:#a6e22e">Program</span>
</span></span><span style="display:flex;"><span>        test_sum_dim
</span></span><span style="display:flex;"><span>        ()
</span></span><span style="display:flex;"><span>        []
</span></span><span style="display:flex;"><span>        []
</span></span><span style="display:flex;"><span>        [(<span style="color:#a6e22e">Declaration</span>
</span></span><span style="display:flex;"><span>            (<span style="color:#a6e22e">AttrType</span>
</span></span><span style="display:flex;"><span>                TypeInteger
</span></span><span style="display:flex;"><span>                []
</span></span><span style="display:flex;"><span>                ()
</span></span><span style="display:flex;"><span>                ()
</span></span><span style="display:flex;"><span>                None
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            []
</span></span><span style="display:flex;"><span>            [(<span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>            [(<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>            DimensionExpr)
</span></span><span style="display:flex;"><span>            (<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>            DimensionExpr)]
</span></span><span style="display:flex;"><span>            []
</span></span><span style="display:flex;"><span>            ()
</span></span><span style="display:flex;"><span>            (<span style="color:#a6e22e">FuncCallOrArray</span>
</span></span><span style="display:flex;"><span>                RESHAPE
</span></span><span style="display:flex;"><span>                []
</span></span><span style="display:flex;"><span>                [(()
</span></span><span style="display:flex;"><span>                (<span style="color:#a6e22e">ArrayInitializer</span>
</span></span><span style="display:flex;"><span>                    ()
</span></span><span style="display:flex;"><span>                    ()
</span></span><span style="display:flex;"><span>                    [<span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">9</span>]
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                ()
</span></span><span style="display:flex;"><span>                <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>                (()
</span></span><span style="display:flex;"><span>                (<span style="color:#a6e22e">ArrayInitializer</span>
</span></span><span style="display:flex;"><span>                    ()
</span></span><span style="display:flex;"><span>                    ()
</span></span><span style="display:flex;"><span>                    [<span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                ()
</span></span><span style="display:flex;"><span>                <span style="color:#ae81ff">0</span>)]
</span></span><span style="display:flex;"><span>                []
</span></span><span style="display:flex;"><span>                []
</span></span><span style="display:flex;"><span>                []
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            Equal
</span></span><span style="display:flex;"><span>            ())]
</span></span><span style="display:flex;"><span>            ()
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        (<span style="color:#a6e22e">Declaration</span>
</span></span><span style="display:flex;"><span>            (<span style="color:#a6e22e">AttrType</span>
</span></span><span style="display:flex;"><span>                TypeInteger
</span></span><span style="display:flex;"><span>                []
</span></span><span style="display:flex;"><span>                ()
</span></span><span style="display:flex;"><span>                ()
</span></span><span style="display:flex;"><span>                None
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            []
</span></span><span style="display:flex;"><span>            [(<span style="color:#a6e22e">dim_</span>
</span></span><span style="display:flex;"><span>            []
</span></span><span style="display:flex;"><span>            []
</span></span><span style="display:flex;"><span>            ()
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>            Equal
</span></span><span style="display:flex;"><span>            ())]
</span></span><span style="display:flex;"><span>            ()
</span></span><span style="display:flex;"><span>        )]
</span></span><span style="display:flex;"><span>        [(<span style="color:#a6e22e">Print</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>            ()
</span></span><span style="display:flex;"><span>            [(<span style="color:#a6e22e">FuncCallOrArray</span>
</span></span><span style="display:flex;"><span>                SUM
</span></span><span style="display:flex;"><span>                []
</span></span><span style="display:flex;"><span>                [(()
</span></span><span style="display:flex;"><span>                x
</span></span><span style="display:flex;"><span>                ()
</span></span><span style="display:flex;"><span>                <span style="color:#ae81ff">0</span>)]
</span></span><span style="display:flex;"><span>                [(<span style="color:#a6e22e">DIM</span>
</span></span><span style="display:flex;"><span>                dim_)]
</span></span><span style="display:flex;"><span>                []
</span></span><span style="display:flex;"><span>                []
</span></span><span style="display:flex;"><span>            )]
</span></span><span style="display:flex;"><span>            ()
</span></span><span style="display:flex;"><span>        )]
</span></span><span style="display:flex;"><span>        []
</span></span><span style="display:flex;"><span>    )]
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>In ASR, the <code>sum</code> function is represented as an <code>IntrinsicArrayFunction</code> node.
This node captures the properties of a sum. The input array <code>x</code>. The dimension
(<code>dim=1</code>) along which the summation should be performed. The ASR node includes
necessary information, like array dimensions and type, and the data is prepared
to ensure that the results fit within an output array of rank <code>n-1</code> (where <code>n</code> is
the rank of x).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-clj" data-lang="clj"><span style="display:flex;"><span>(<span style="color:#a6e22e">TranslationUnit</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">SymbolTable</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            test_sum_dim<span style="color:#960050;background-color:#1e0010">:</span>
</span></span><span style="display:flex;"><span>                (<span style="color:#a6e22e">Program</span>
</span></span><span style="display:flex;"><span>                    (<span style="color:#a6e22e">SymbolTable</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>                        {
</span></span><span style="display:flex;"><span>                            dim_<span style="color:#960050;background-color:#1e0010">:</span>
</span></span><span style="display:flex;"><span>                                (<span style="color:#a6e22e">Variable</span>
</span></span><span style="display:flex;"><span>                                    <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>                                    dim_
</span></span><span style="display:flex;"><span>                                    []
</span></span><span style="display:flex;"><span>                                    Local
</span></span><span style="display:flex;"><span>                                    (<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                    (<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                    Save
</span></span><span style="display:flex;"><span>                                    (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                                    ()
</span></span><span style="display:flex;"><span>                                    Source
</span></span><span style="display:flex;"><span>                                    Public
</span></span><span style="display:flex;"><span>                                    Required
</span></span><span style="display:flex;"><span>                                    .false.
</span></span><span style="display:flex;"><span>                                ),
</span></span><span style="display:flex;"><span>                            x<span style="color:#960050;background-color:#1e0010">:</span>
</span></span><span style="display:flex;"><span>                                (<span style="color:#a6e22e">Variable</span>
</span></span><span style="display:flex;"><span>                                    <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>                                    x
</span></span><span style="display:flex;"><span>                                    []
</span></span><span style="display:flex;"><span>                                    Local
</span></span><span style="display:flex;"><span>                                    (<span style="color:#a6e22e">ArrayReshape</span>
</span></span><span style="display:flex;"><span>                                        (<span style="color:#a6e22e">ArrayConstant</span>
</span></span><span style="display:flex;"><span>                                            <span style="color:#ae81ff">36</span>
</span></span><span style="display:flex;"><span>                                            [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, ...., <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>]
</span></span><span style="display:flex;"><span>                                            (<span style="color:#a6e22e">Array</span>
</span></span><span style="display:flex;"><span>                                                (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                                                [((<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                                (<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">9</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal))]
</span></span><span style="display:flex;"><span>                                                FixedSizeArray
</span></span><span style="display:flex;"><span>                                            )
</span></span><span style="display:flex;"><span>                                            ColMajor
</span></span><span style="display:flex;"><span>                                        )
</span></span><span style="display:flex;"><span>                                        (<span style="color:#a6e22e">ArrayPhysicalCast</span>
</span></span><span style="display:flex;"><span>                                            (<span style="color:#a6e22e">ArrayConstant</span>
</span></span><span style="display:flex;"><span>                                                <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>                                                [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>]
</span></span><span style="display:flex;"><span>                                                (<span style="color:#a6e22e">Array</span>
</span></span><span style="display:flex;"><span>                                                    (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                                                    [((<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                                    (<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">2</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal))]
</span></span><span style="display:flex;"><span>                                                    FixedSizeArray
</span></span><span style="display:flex;"><span>                                                )
</span></span><span style="display:flex;"><span>                                                ColMajor
</span></span><span style="display:flex;"><span>                                            )
</span></span><span style="display:flex;"><span>                                            FixedSizeArray
</span></span><span style="display:flex;"><span>                                            DescriptorArray
</span></span><span style="display:flex;"><span>                                            (<span style="color:#a6e22e">Array</span>
</span></span><span style="display:flex;"><span>                                                (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                                                [((<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                                (<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">2</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal))]
</span></span><span style="display:flex;"><span>                                                DescriptorArray
</span></span><span style="display:flex;"><span>                                            )
</span></span><span style="display:flex;"><span>                                            ()
</span></span><span style="display:flex;"><span>                                        )
</span></span><span style="display:flex;"><span>                                        (<span style="color:#a6e22e">Array</span>
</span></span><span style="display:flex;"><span>                                            (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                                            [((<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                            (<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">3</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal))
</span></span><span style="display:flex;"><span>                                            ((<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                            (<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">3</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal))]
</span></span><span style="display:flex;"><span>                                            FixedSizeArray
</span></span><span style="display:flex;"><span>                                        )
</span></span><span style="display:flex;"><span>                                        ()
</span></span><span style="display:flex;"><span>                                    )
</span></span><span style="display:flex;"><span>                                    ()
</span></span><span style="display:flex;"><span>                                    Save
</span></span><span style="display:flex;"><span>                                    (<span style="color:#a6e22e">Array</span>
</span></span><span style="display:flex;"><span>                                        (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                                        [((<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                        (<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">3</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal))
</span></span><span style="display:flex;"><span>                                        ((<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                        (<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">3</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal))]
</span></span><span style="display:flex;"><span>                                        FixedSizeArray
</span></span><span style="display:flex;"><span>                                    )
</span></span><span style="display:flex;"><span>                                    ()
</span></span><span style="display:flex;"><span>                                    Source
</span></span><span style="display:flex;"><span>                                    Public
</span></span><span style="display:flex;"><span>                                    Required
</span></span><span style="display:flex;"><span>                                    .false.
</span></span><span style="display:flex;"><span>                                )
</span></span><span style="display:flex;"><span>                        })
</span></span><span style="display:flex;"><span>                    test_sum_dim
</span></span><span style="display:flex;"><span>                    []
</span></span><span style="display:flex;"><span>                    [(<span style="color:#a6e22e">Print</span>
</span></span><span style="display:flex;"><span>                        (<span style="color:#a6e22e">StringFormat</span>
</span></span><span style="display:flex;"><span>                            ()
</span></span><span style="display:flex;"><span>                            [(<span style="color:#a6e22e">IntrinsicArrayFunction</span>
</span></span><span style="display:flex;"><span>                                Sum
</span></span><span style="display:flex;"><span>                                [(<span style="color:#a6e22e">ArrayPhysicalCast</span>
</span></span><span style="display:flex;"><span>                                    (<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">2</span> x)
</span></span><span style="display:flex;"><span>                                    FixedSizeArray
</span></span><span style="display:flex;"><span>                                    DescriptorArray
</span></span><span style="display:flex;"><span>                                    (<span style="color:#a6e22e">Array</span>
</span></span><span style="display:flex;"><span>                                        (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                                        [((<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                        (<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">3</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal))
</span></span><span style="display:flex;"><span>                                        ((<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                        (<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">3</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal))]
</span></span><span style="display:flex;"><span>                                        DescriptorArray
</span></span><span style="display:flex;"><span>                                    )
</span></span><span style="display:flex;"><span>                                    ()
</span></span><span style="display:flex;"><span>                                )
</span></span><span style="display:flex;"><span>                                (<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">2</span> dim_)]
</span></span><span style="display:flex;"><span>                                <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>                                (<span style="color:#a6e22e">Array</span>
</span></span><span style="display:flex;"><span>                                    (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                                    [((<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                    (<span style="color:#a6e22e">IntrinsicElementalFunction</span>
</span></span><span style="display:flex;"><span>                                        Merge
</span></span><span style="display:flex;"><span>                                        [(<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">3</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                        (<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">3</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                        (<span style="color:#a6e22e">IntegerCompare</span>
</span></span><span style="display:flex;"><span>                                            (<span style="color:#a6e22e">IntegerConstant</span> <span style="color:#ae81ff">1</span> (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>) Decimal)
</span></span><span style="display:flex;"><span>                                            Lt
</span></span><span style="display:flex;"><span>                                            (<span style="color:#a6e22e">Var</span> <span style="color:#ae81ff">2</span> dim_)
</span></span><span style="display:flex;"><span>                                            (<span style="color:#a6e22e">Logical</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                                            ()
</span></span><span style="display:flex;"><span>                                        )]
</span></span><span style="display:flex;"><span>                                        <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                                        (<span style="color:#a6e22e">Integer</span> <span style="color:#ae81ff">4</span>)
</span></span><span style="display:flex;"><span>                                        ()
</span></span><span style="display:flex;"><span>                                    ))]
</span></span><span style="display:flex;"><span>                                    DescriptorArray
</span></span><span style="display:flex;"><span>                                )
</span></span><span style="display:flex;"><span>                                ()
</span></span><span style="display:flex;"><span>                            )]
</span></span><span style="display:flex;"><span>                            FormatFortran
</span></span><span style="display:flex;"><span>                            (<span style="color:#a6e22e">Character</span> <span style="color:#ae81ff">-1</span> <span style="color:#ae81ff">0</span> () PointerString)
</span></span><span style="display:flex;"><span>                            ()
</span></span><span style="display:flex;"><span>                        )
</span></span><span style="display:flex;"><span>                    )]
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>    []
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>Using <code>lfortran a.f90 --dump-all-passes-fortran</code>, the generated code reveals
the creation of a subroutine (<code>Sum_4_2_1</code>) that calculates the row or column (or
any other dimension) sum based on the dimension specified. After applying the
intrinsic function pass, the generated code looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fortran" data-lang="fortran"><span style="display:flex;"><span><span style="color:#75715e">! Fortran code after applying the pass: intrinsic_function
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">program</span> test_sum_dim
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">none</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>), <span style="color:#66d9ef">dimension</span>(:), <span style="color:#66d9ef">allocatable</span> <span style="color:#66d9ef">::</span> <span style="color:#960050;background-color:#1e0010">__</span>libasr__created__var__0_Sum_4_2_1_res
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>), <span style="color:#66d9ef">save</span> <span style="color:#66d9ef">::</span> dim_ <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>), <span style="color:#66d9ef">dimension</span>(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>), <span style="color:#66d9ef">save</span> <span style="color:#66d9ef">::</span> x <span style="color:#f92672">=</span> reshape([<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">9</span>], [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">allocate</span>(<span style="color:#960050;background-color:#1e0010">__</span>libasr__created__var__0_Sum_4_2_1_res(<span style="color:#960050;background-color:#1e0010">_</span>lcompilers_merge_i32(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;</span> dim_)))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">call</span> Sum_4_2_1(x, dim_, <span style="color:#960050;background-color:#1e0010">__</span>libasr__created__var__0_Sum_4_2_1_res)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">print</span> <span style="color:#f92672">*</span>, <span style="color:#960050;background-color:#1e0010">__</span>libasr__created__var__0_Sum_4_2_1_res
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">contains</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">subroutine</span> Sum_4_2_1(<span style="color:#66d9ef">array</span>, dim, <span style="color:#66d9ef">result</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>) <span style="color:#66d9ef">::</span> <span style="color:#960050;background-color:#1e0010">__</span><span style="color:#ae81ff">1_j</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>) <span style="color:#66d9ef">::</span> <span style="color:#960050;background-color:#1e0010">__</span><span style="color:#ae81ff">2_j</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>), <span style="color:#66d9ef">dimension</span>(:, :), <span style="color:#66d9ef">intent</span>(in) <span style="color:#66d9ef">::</span> <span style="color:#66d9ef">array</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>), <span style="color:#66d9ef">intent</span>(in) <span style="color:#66d9ef">::</span> dim
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>), <span style="color:#66d9ef">dimension</span>(:), <span style="color:#66d9ef">intent</span>(out) <span style="color:#66d9ef">::</span> <span style="color:#66d9ef">result</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">result</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (dim <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">do</span> <span style="color:#960050;background-color:#1e0010">__</span><span style="color:#ae81ff">1_j</span> <span style="color:#f92672">=</span> lbound(<span style="color:#66d9ef">array</span>, <span style="color:#ae81ff">1</span>), ubound(<span style="color:#66d9ef">array</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">do</span> <span style="color:#960050;background-color:#1e0010">__</span><span style="color:#ae81ff">2_j</span> <span style="color:#f92672">=</span> lbound(<span style="color:#66d9ef">array</span>, <span style="color:#ae81ff">2</span>), ubound(<span style="color:#66d9ef">array</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">result</span>(<span style="color:#960050;background-color:#1e0010">__</span><span style="color:#ae81ff">1_j</span>) <span style="color:#f92672">=</span> <span style="color:#66d9ef">result</span>(<span style="color:#960050;background-color:#1e0010">__</span><span style="color:#ae81ff">1_j</span>) <span style="color:#f92672">+</span> <span style="color:#66d9ef">array</span>(<span style="color:#960050;background-color:#1e0010">__</span><span style="color:#ae81ff">1_j</span>, <span style="color:#960050;background-color:#1e0010">__</span><span style="color:#ae81ff">2_j</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (dim <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>) <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">do</span> <span style="color:#960050;background-color:#1e0010">__</span><span style="color:#ae81ff">2_j</span> <span style="color:#f92672">=</span> lbound(<span style="color:#66d9ef">array</span>, <span style="color:#ae81ff">2</span>), ubound(<span style="color:#66d9ef">array</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">do</span> <span style="color:#960050;background-color:#1e0010">__</span><span style="color:#ae81ff">1_j</span> <span style="color:#f92672">=</span> lbound(<span style="color:#66d9ef">array</span>, <span style="color:#ae81ff">1</span>), ubound(<span style="color:#66d9ef">array</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">result</span>(<span style="color:#960050;background-color:#1e0010">__</span><span style="color:#ae81ff">2_j</span>) <span style="color:#f92672">=</span> <span style="color:#66d9ef">result</span>(<span style="color:#960050;background-color:#1e0010">__</span><span style="color:#ae81ff">2_j</span>) <span style="color:#f92672">+</span> <span style="color:#66d9ef">array</span>(<span style="color:#960050;background-color:#1e0010">__</span><span style="color:#ae81ff">1_j</span>, <span style="color:#960050;background-color:#1e0010">__</span><span style="color:#ae81ff">2_j</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">if</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">if</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span> <span style="color:#66d9ef">subroutine</span> Sum_4_2_1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>) <span style="color:#66d9ef">function</span> <span style="color:#960050;background-color:#1e0010">_</span>lcompilers_merge_i32(tsource, fsource, mask) <span style="color:#66d9ef">result</span>(merge)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>), <span style="color:#66d9ef">intent</span>(in) <span style="color:#66d9ef">::</span> fsource
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">logical</span>(<span style="color:#ae81ff">4</span>), <span style="color:#66d9ef">intent</span>(in) <span style="color:#66d9ef">::</span> mask
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">integer</span>(<span style="color:#ae81ff">4</span>), <span style="color:#66d9ef">intent</span>(in) <span style="color:#66d9ef">::</span> tsource
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (mask) <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>        merge <span style="color:#f92672">=</span> tsource
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        merge <span style="color:#f92672">=</span> fsource
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">end</span> <span style="color:#66d9ef">if</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span> <span style="color:#66d9ef">function</span> <span style="color:#960050;background-color:#1e0010">_</span>lcompilers_merge_i32
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span> <span style="color:#66d9ef">program</span> test_sum_dim
</span></span></code></pre></div><p>This implementation of <code>sum</code> demonstrates how LFortran handles multi-dimensional
intrinsic functions efficiently. The <code>sum</code> function is transformed into an ASR
node, encapsulating its arguments, dimension, and the return type. A dedicated
subroutine (<code>Sum_4_2_1</code>) is generated to handle the summation along a specific
dimension, enhancing performance by eliminating runtime overhead. The final
output array is created by reducing the rank of the input array by 1, storing
only the necessary results.</p>
<h2 id="conclusion">Conclusion</h2>
<p>This design makes <code>sum</code> and other intrinsic functions
highly efficient, handling multi-dimensional arrays without requiring complex
runtime modules, while also making the generated code lightweight and
efficient as it
eliminates any
overhead compared to manually implementing constructs like <code>if</code> conditions
instead of calling <code>max</code>. Both the ASR and LLVM representations access the
actual, inlined code, enabling the compiler to optimize and specialize as
needed; an advantage not possible when calling a runtime library function. This
approach ensures that intrinsic functions are as efficient as manually written
code, while also being optimized seamlessly within the compilation process.</p>
<h2 id="join-us">Join us</h2>
<p>Join us in advancing LFortran! New contributors are always welcome, connect with us on  <a href="https://lfortran.zulipchat.com/">Zulip</a> to get started.</p>
<h2 id="acknowledgements">Acknowledgements</h2>
<p>We want to thank:</p>
<ul>
<li><a href="https://sovereigntechfund.de/en/">Sovereign Tech Fund (STF)</a></li>
<li><a href="https://numfocus.org/">NumFOCUS</a></li>
<li><a href="https://quantstack.net/">QuantStack</a></li>
<li><a href="https://summerofcode.withgoogle.com/">Google Summer of Code</a></li>
<li><a href="https://www.johndcook.com/blog/expert-hipaa-deidentification/">John D. Cook</a></li>
<li><a href="https://gsitechnology.com/">GSI Technology</a></li>
<li><a href="https://lanl.gov/">LANL</a></li>
<li>Our GitHub, OpenCollective and NumFOCUS sponsors</li>
<li>All our contributors (92 so far!)</li>
</ul>
<h2 id="discussions">Discussions</h2>
<ul>
<li>Fortran Discourse: <a href="https://fortran-lang.discourse.group/t/lfortran-now-supports-all-intrinsic-functions/8844">https://fortran-lang.discourse.group/t/lfortran-now-supports-all-intrinsic-functions/8844</a></li>
<li>Twitter: <a href="https://x.com/lfortranorg/status/1857087857178902894">https://x.com/lfortranorg/status/1857087857178902894</a></li>
<li>Mastodon:</li>
<li>LinkedIn:</li>
</ul>


        
          <div class="blog-tags">
            
              
              <a href="https://lfortran.org/tags/fortran/">Fortran</a>&nbsp;
            
              
              <a href="https://lfortran.org/tags/announcement/">Announcement</a>&nbsp;
            
              
              <a href="https://lfortran.org/tags/intrinsicfunctions/">IntrinsicFunctions</a>&nbsp;
            
              
              <a href="https://lfortran.org/tags/fortran-lang/">fortran-lang</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://lfortran.org/blog/2024/08/lfortran-now-compiles-snap/" data-toggle="tooltip" data-placement="top" title="LFortran now compiles SNAP">&larr; Previous Post</a>
            </li>
          
          
        </ul>
      


      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            2024
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://lfortran.org/">LFortran</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
           
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="https://lfortran.org/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://lfortran.org/js/load-photoswipe.js"></script>










  </body>
</html>

