<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-138613977-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-138613977-1');
</script>


  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

 


      <title>LFortran: the Fastest Open-Source Compiler in Compile-Time Evaluation of an Array Benchmark - </title>

  <meta name="description" content="After successful compilation of stdlib and Fortran On Web Using LFortran, we focused on improving the support for compile time computation and we are excited to announce that LFortran can now compile the example from the Computing at compile time Fortran Discourse topic.
This example can be used to benchmark the speed of compilation and compile-time array evaluation by increasing the size of the arrays. On this particular example LFortran outperforms other open-source Fortran compilers by an order of magnitude for large array sizes. For small array sizes each compiler has a different constant overhead, which becomes negligible for large arrays and this benchmark measures how quickly the compiler can internally apply the symbolic function on a large array numerically."><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "LFortran",
    
    "url": "https:\/\/lfortran.org\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/lfortran.org\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/lfortran.org\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/lfortran.org\/blog\/2024\/06\/lfortran-the-fastest-open-source-compiler-in-compile-time-evaluation-of-an-array-benchmark\/",
          "name": "Lfortran the fastest open source compiler in compile time evaluation of an array benchmark"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "[Harshita Kalani](https:\/\/www.linkedin.com\/in\/harshita-kalani-604866225\/), [Pranav Goswami](https:\/\/www.linkedin.com\/in\/pranavgoswami1\/), [Parth Mistry](https:\/\/github.com\/parth121101), [Ubaid Shaikh](https:\/\/github.com\/Shaikh-Ubaid), [Ondřej Čertík](https:\/\/ondrejcertik.com\/), [Gaurav Dhingra](https:\/\/github.com\/gxyd), [Thirumalai Shaktivel](https:\/\/www.linkedin.com\/in\/thirumalai-shaktivel\/), [Gagandeep Singh](https:\/\/github.com\/czgdp1807), [Assem Medhat](https:\/\/github.com\/assem2002), [Saurabh Kumar](https:\/\/github.com\/kmr-srbh), [Vipul Cariappa](https:\/\/github.com\/Vipul-Cariappa)"
  },
  "headline": "LFortran: the Fastest Open-Source Compiler in Compile-Time Evaluation of an Array Benchmark",
  "description" : "After successful compilation of stdlib and Fortran On Web Using LFortran, we focused on improving the support for compile time computation and we are excited to announce that LFortran can now compile the example from the Computing at compile time Fortran Discourse topic.\nThis example can be used to benchmark the speed of compilation and compile-time array evaluation by increasing the size of the arrays. On this particular example LFortran outperforms other open-source Fortran compilers by an order of magnitude for large array sizes. For small array sizes each compiler has a different constant overhead, which becomes negligible for large arrays and this benchmark measures how quickly the compiler can internally apply the symbolic function on a large array numerically.\n",
  "inLanguage" : "en",
  "wordCount":  1062 ,
  "datePublished" : "2024-06-04T00:00:00\u002b00:00",
  "dateModified" : "2024-06-04T00:00:00\u002b00:00",
  "image" : "https:\/\/lfortran.org\/",
  "keywords" : [ "Fortran, Announcement, Performance, Arrays" ],
  "mainEntityOfPage" : "https:\/\/lfortran.org\/blog\/2024\/06\/lfortran-the-fastest-open-source-compiler-in-compile-time-evaluation-of-an-array-benchmark\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/lfortran.org\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/lfortran.org\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>


<meta property="og:title" content="LFortran: the Fastest Open-Source Compiler in Compile-Time Evaluation of an Array Benchmark" />
<meta property="og:description" content="After successful compilation of stdlib and Fortran On Web Using LFortran, we focused on improving the support for compile time computation and we are excited to announce that LFortran can now compile the example from the Computing at compile time Fortran Discourse topic.
This example can be used to benchmark the speed of compilation and compile-time array evaluation by increasing the size of the arrays. On this particular example LFortran outperforms other open-source Fortran compilers by an order of magnitude for large array sizes. For small array sizes each compiler has a different constant overhead, which becomes negligible for large arrays and this benchmark measures how quickly the compiler can internally apply the symbolic function on a large array numerically.">
<meta property="og:url" content="https://lfortran.org/blog/2024/06/lfortran-the-fastest-open-source-compiler-in-compile-time-evaluation-of-an-array-benchmark/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="LFortran" />

  <meta name="twitter:title" content="LFortran: the Fastest Open-Source Compiler in Compile-Time Evaluation …" />
  <meta name="twitter:description" content="After successful compilation of stdlib and Fortran On Web Using LFortran, we focused on improving the support for compile time computation and we are excited to announce that LFortran can now compile …">
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="generator" content="Hugo 0.138.0">
  <link rel="alternate" href="https://lfortran.org/index.xml" type="application/rss+xml" title="LFortran"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://lfortran.org/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://lfortran.org/css/syntax.css" /><link rel="stylesheet" href="https://lfortran.org/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">





<style>
h2 {
    font-size: 20px;
}
p, li {
    text-align: justify;
}
img {
    display: inline;
}
h1.h1heading {
    text-align: center;
}
h2.h2heading {
    text-align: center;
    font-size: 20px;
    font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
    font-weight: 300;
    margin: 0 0 0;
}
#benefit i {
    margin-right: 20px;
}
#benefit {
    padding-left: 30px;
    padding-right: 30px;
}
#benefits {
    margin-top: 30px;
    margin-bottom: 50px;
}
.post-heading .post-meta a {
  color: #008AFF;
}
.post-heading .post-meta a:hover, a:focus {
  color: #0085a1;
  text-decoration: underline;
}

[data-toggle="collapse"].collapsed .if-not-collapsed {
  display: none;
}
[data-toggle="collapse"]:not(.collapsed) .if-collapsed {
  display: none;
}
</style>

  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://lfortran.org/">LFortran</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Download" href="/download/">Download</a>
            </li>
          
        
          
            <li>
              <a title="Documentation" href="https://docs.lfortran.org/">Documentation</a>
            </li>
          
        
          
            <li>
              <a title="Blog" href="/blog/">Blog</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>LFortran: the Fastest Open-Source Compiler in Compile-Time Evaluation of an Array Benchmark</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on June 4, 2024
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;5&nbsp;minutes
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;1062&nbsp;words
  
  
    &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;<a href="https://www.linkedin.com/in/harshita-kalani-604866225/">Harshita Kalani</a>, <a href="https://www.linkedin.com/in/pranavgoswami1/">Pranav Goswami</a>, <a href="https://github.com/parth121101">Parth Mistry</a>, <a href="https://github.com/Shaikh-Ubaid">Ubaid Shaikh</a>, <a href="https://ondrejcertik.com/">Ondřej Čertík</a>, <a href="https://github.com/gxyd">Gaurav Dhingra</a>, <a href="https://www.linkedin.com/in/thirumalai-shaktivel/">Thirumalai Shaktivel</a>, <a href="https://github.com/czgdp1807">Gagandeep Singh</a>, <a href="https://github.com/assem2002">Assem Medhat</a>, <a href="https://github.com/kmr-srbh">Saurabh Kumar</a>, <a href="https://github.com/Vipul-Cariappa">Vipul Cariappa</a>
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>After successful <a href="https://lfortran.org/blog/2024/04/lfortran-compiles-fortran-stdlib/">compilation of <code>stdlib</code></a> and <a href="https://lfortran.org/blog/2024/05/fortran-on-web-using-lfortran/">Fortran On Web Using LFortran</a>, we focused on improving the support for compile time computation and we are excited to announce that LFortran can now compile the example from the <a href="https://fortran-lang.discourse.group/t/computing-at-compile-time/3044">Computing at compile time</a> Fortran Discourse topic.</p>
<p>This example can be used to benchmark the speed of compilation and compile-time array evaluation by increasing the size of the arrays. On this particular example LFortran outperforms other open-source Fortran compilers by an order of magnitude for large array sizes. For small array sizes each compiler has a different constant overhead, which becomes negligible for large arrays and this benchmark measures how quickly the compiler can internally apply the symbolic function on a large array numerically.</p>
<p>You can try LFortran yourself on other examples and if you find that other compilers significantly outperform it in the speed of compilation, please let us know.</p>
<p>Why care about the speed of compilation? When developing large Fortran codes, it is essential to compile as quickly as possible to make the edit-compile-run cycle short. It must be a pleasure to develop in Fortran. Fast compilation, beautiful error messages both at compile time and runtime in Debug mode (no segfaults).</p>
<p>When running in production, we then want the fastest performance at runtime. LFortran&rsquo;s goal is to be fast to compile in Debug mode and fast to run in Release mode.</p>
<p>LFortran is currently alpha software, meaning that users must continue expecting that LFortran will fail compiling or running their codes. Please report all bugs that you find.</p>
<h2 id="compilation-benchmark">Compilation Benchmark</h2>
<p>The following program computes the integral of sin(x) from 0 to pi at compile-time using the simplest linear approximation:</p>
<blockquote>
<p>compile_time.f90</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fortran" data-lang="fortran"><span style="display:flex;"><span><span style="color:#66d9ef">program</span> compile_time
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">none</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">integer</span>, <span style="color:#66d9ef">parameter</span> <span style="color:#66d9ef">::</span> N <span style="color:#f92672">=</span> <span style="color:#ae81ff">65535</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">integer</span>, <span style="color:#66d9ef">parameter</span> <span style="color:#66d9ef">::</span> sp <span style="color:#f92672">=</span> kind(<span style="color:#ae81ff">1.0</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">integer</span>, <span style="color:#66d9ef">parameter</span> <span style="color:#66d9ef">::</span> dp <span style="color:#f92672">=</span> kind(<span style="color:#ae81ff">1.d0</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">real</span>(dp), <span style="color:#66d9ef">parameter</span> <span style="color:#66d9ef">::</span> pi <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>asin(<span style="color:#ae81ff">1._dp</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">real</span>(dp), <span style="color:#66d9ef">parameter</span> <span style="color:#66d9ef">::</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, b <span style="color:#f92672">=</span> pi
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">real</span>(dp), <span style="color:#66d9ef">parameter</span> <span style="color:#66d9ef">::</span> dx <span style="color:#f92672">=</span> (b<span style="color:#f92672">-</span>a)<span style="color:#f92672">/</span>N
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">integer</span> <span style="color:#66d9ef">::</span> i
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">real</span>(dp), <span style="color:#66d9ef">parameter</span> <span style="color:#66d9ef">::</span> X(<span style="color:#f92672">*</span>) <span style="color:#f92672">=</span> [(sin(a<span style="color:#f92672">+</span>(b<span style="color:#f92672">-</span>a)<span style="color:#f92672">*</span>i<span style="color:#f92672">/</span>N), i <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>, N)]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">real</span>(dp), <span style="color:#66d9ef">parameter</span> <span style="color:#66d9ef">::</span> S <span style="color:#f92672">=</span> sum(X)<span style="color:#f92672">*</span>dx
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">logical</span>, <span style="color:#66d9ef">parameter</span> <span style="color:#66d9ef">::</span> l <span style="color:#f92672">=</span> S <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">real</span>(kind<span style="color:#f92672">=</span>merge(sp, dp, l)) <span style="color:#66d9ef">::</span> y
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (kind(y) <span style="color:#f92672">==</span> sp) <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">print</span> <span style="color:#f92672">*</span>, <span style="color:#e6db74">&#34;true&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">print</span> <span style="color:#f92672">*</span>, <span style="color:#e6db74">&#34;false&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span> <span style="color:#66d9ef">if</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">print</span> <span style="color:#f92672">*</span>, S
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">end</span> <span style="color:#66d9ef">program</span>
</span></span></code></pre></div><p>Now we benchmark the compilation speed with various compilers depending on the array size N (the number of integration points).</p>
<p>On MacBook Air M2 8GB RAM</p>
<table>
  <thead>
      <tr>
          <th>N</th>
          <th>GFortran (s)</th>
          <th>LFortran (s)</th>
          <th>GFortran / LFortran</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>10</td>
          <td>0.065</td>
          <td>0.068</td>
          <td>0.9558823529</td>
      </tr>
      <tr>
          <td>100</td>
          <td>0.067</td>
          <td>0.068</td>
          <td>0.9852941176</td>
      </tr>
      <tr>
          <td>1000</td>
          <td>0.081</td>
          <td>0.068</td>
          <td>1.191176471</td>
      </tr>
      <tr>
          <td>10000</td>
          <td>0.224</td>
          <td>0.07</td>
          <td>3.2</td>
      </tr>
      <tr>
          <td>25000</td>
          <td>0.464</td>
          <td>0.08</td>
          <td>5.8</td>
      </tr>
      <tr>
          <td>50000</td>
          <td>0.867</td>
          <td>0.085</td>
          <td>10.2</td>
      </tr>
      <tr>
          <td>75000</td>
          <td>1.273</td>
          <td>0.089</td>
          <td>14.30337079</td>
      </tr>
      <tr>
          <td>100000</td>
          <td>1.666</td>
          <td>0.097</td>
          <td>17.17525773</td>
      </tr>
      <tr>
          <td>250000</td>
          <td>4.083</td>
          <td>0.137</td>
          <td>29.80291971</td>
      </tr>
      <tr>
          <td>500000</td>
          <td>8.128</td>
          <td>0.208</td>
          <td>39.07692308</td>
      </tr>
      <tr>
          <td>750000</td>
          <td>12.25</td>
          <td>0.276</td>
          <td>44.38405797</td>
      </tr>
      <tr>
          <td>1000000</td>
          <td>16.431</td>
          <td>0.345</td>
          <td>47.62608696</td>
      </tr>
      <tr>
          <td>2500000</td>
          <td>41.947</td>
          <td>0.757</td>
          <td>55.41215324</td>
      </tr>
      <tr>
          <td>5000000</td>
          <td>85.506</td>
          <td>1.447</td>
          <td>59.09191431</td>
      </tr>
      <tr>
          <td>7500000</td>
          <td>131.474</td>
          <td>2.15</td>
          <td>61.15069767</td>
      </tr>
      <tr>
          <td>10000000</td>
          <td>176.646</td>
          <td>2.846</td>
          <td>62.06816585</td>
      </tr>
  </tbody>
</table>
<p>On Surface Laptop 5; WSL, Ubuntu 22.04, 12th Gen Intel(R) Core(TM) i7-1265U</p>
<table>
  <thead>
      <tr>
          <th>N</th>
          <th>LFortran</th>
          <th>GFortran</th>
          <th>Flang</th>
          <th>GFortran / LFortran</th>
          <th>Flang / LFortran</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>1</td>
          <td>0.136</td>
          <td>0.135</td>
          <td>0.187</td>
          <td>0.992647059</td>
          <td>1.375</td>
      </tr>
      <tr>
          <td>10</td>
          <td>0.137</td>
          <td>0.148</td>
          <td>0.217</td>
          <td>1.080291971</td>
          <td>1.583941606</td>
      </tr>
      <tr>
          <td>100</td>
          <td>0.136</td>
          <td>0.149</td>
          <td>0.202</td>
          <td>1.095588235</td>
          <td>1.485294118</td>
      </tr>
      <tr>
          <td>1.00E+03</td>
          <td>0.164</td>
          <td>0.163</td>
          <td>0.19</td>
          <td>0.993902439</td>
          <td>1.158536585</td>
      </tr>
      <tr>
          <td>1.00E+04</td>
          <td>0.167</td>
          <td>0.25</td>
          <td>0.278</td>
          <td>1.497005988</td>
          <td>1.664670659</td>
      </tr>
      <tr>
          <td>1.00E+05</td>
          <td>0.175</td>
          <td>2.066</td>
          <td>0.691</td>
          <td>11.80571429</td>
          <td>3.948571429</td>
      </tr>
      <tr>
          <td>2.50E+05</td>
          <td>0.203</td>
          <td>4.962</td>
          <td>1.419</td>
          <td>24.44334975</td>
          <td>6.990147783</td>
      </tr>
      <tr>
          <td>5.00E+05</td>
          <td>0.238</td>
          <td>10.199</td>
          <td>2.621</td>
          <td>42.85294118</td>
          <td>11.01260504</td>
      </tr>
      <tr>
          <td>7.50E+05</td>
          <td>0.299</td>
          <td>15.047</td>
          <td>3.728</td>
          <td>50.32441472</td>
          <td>12.46822742</td>
      </tr>
      <tr>
          <td>1.00E+06</td>
          <td>0.402</td>
          <td>19.671</td>
          <td>5.009</td>
          <td>48.93283582</td>
          <td>12.460199</td>
      </tr>
      <tr>
          <td>2.00E+06</td>
          <td>0.649</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>3.00E+06</td>
          <td>0.871</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td>4.00E+06</td>
          <td>1.057</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
          <td>-</td>
      </tr>
  </tbody>
</table>
<p>On Ryzen 7 5800, 16G RAM, Ubuntu</p>
<table>
  <thead>
      <tr>
          <th>N</th>
          <th>LFortran</th>
          <th>GFortran</th>
          <th>Flang</th>
          <th>GFortran / LFortran</th>
          <th>Flang / LFortran</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>10</td>
          <td>0.036</td>
          <td>0.024</td>
          <td>0.113</td>
          <td>0.666667</td>
          <td>3.138889</td>
      </tr>
      <tr>
          <td>100</td>
          <td>0.036</td>
          <td>0.028</td>
          <td>0.107</td>
          <td>0.777778</td>
          <td>2.972222</td>
      </tr>
      <tr>
          <td>1000</td>
          <td>0.036</td>
          <td>0.039</td>
          <td>0.115</td>
          <td>1.083333</td>
          <td>3.194444</td>
      </tr>
      <tr>
          <td>10000</td>
          <td>0.033</td>
          <td>0.160</td>
          <td>0.152</td>
          <td>4.848485</td>
          <td>4.606061</td>
      </tr>
      <tr>
          <td>25000</td>
          <td>0.035</td>
          <td>0.386</td>
          <td>0.176</td>
          <td>11.028571</td>
          <td>5.028571</td>
      </tr>
      <tr>
          <td>50000</td>
          <td>0.035</td>
          <td>0.821</td>
          <td>0.302</td>
          <td>23.457143</td>
          <td>8.628571</td>
      </tr>
      <tr>
          <td>75000</td>
          <td>0.047</td>
          <td>1.236</td>
          <td>0.378</td>
          <td>26.297872</td>
          <td>8.042553</td>
      </tr>
      <tr>
          <td>100000</td>
          <td>0.053</td>
          <td>2.412</td>
          <td>0.498</td>
          <td>45.509434</td>
          <td>9.396226</td>
      </tr>
      <tr>
          <td>250000</td>
          <td>0.090</td>
          <td>4.399</td>
          <td>1.082</td>
          <td>48.877778</td>
          <td>12.022222</td>
      </tr>
      <tr>
          <td>500000</td>
          <td>0.126</td>
          <td>9.093</td>
          <td>2.162</td>
          <td>72.166667</td>
          <td>17.158730</td>
      </tr>
      <tr>
          <td>750000</td>
          <td>0.156</td>
          <td>13.679</td>
          <td>3.234</td>
          <td>87.685897</td>
          <td>20.730769</td>
      </tr>
      <tr>
          <td>1000000</td>
          <td>0.234</td>
          <td>17.893</td>
          <td>4.792</td>
          <td>76.465812</td>
          <td>20.478632</td>
      </tr>
  </tbody>
</table>
<p>The above tables are visualized in the graphs below:</p>
<p><img src="https://lfortran.org/images/speed_of_compilation1.png" alt="Surface"></p>
<p><img src="https://lfortran.org/images/speed_of_compilation2.png" alt="Ryzen"></p>
<p><img src="https://lfortran.org/images/speed_of_compilation3.png" alt="Apple M2"></p>
<h2 id="how-to-run-the-benchmark-yourself">How to Run the Benchmark Yourself</h2>
<p>We installed LFortran, GFortran and Flang using Conda, that way you can install exactly the same binary as well, and that way if there is any issue how each compiler was compiled into the conda package, one can simply send a PR against the conda-forge repository to improve it, and the compiler developers can ensure that their compiler is compiled correctly with maximum performance.</p>
<p>Create a conda environment with exactly the versions that we used:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>mamba create -n ct lfortran=0.36.0 gfortran=13.2.0 flang=18.1.6
</span></span><span style="display:flex;"><span>mamba activate ct
</span></span></code></pre></div><p>Benchmark the speed of compilation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>time lfortran compile_time.f90 -o a.out
</span></span><span style="display:flex;"><span>time gfortran -fmax-array-constructor=10000000 compile_time.f90 -o a.out
</span></span><span style="display:flex;"><span>time flang-new compile_time.f90 -o a.out
</span></span></code></pre></div><p>Note: Flang currently does not have a conda package for Apple Silicon, so we only benchmarked it on Linux.</p>
<h2 id="development-overview">Development Overview</h2>
<p>The roots of development lead us to <a href="https://github.com/lfortran/lfortran/pull/3564">PR#3564</a> which aimed to handle compile time evaluation of elemental functions. At that time we only had <code>ArrayConstant</code> represented in ASR grammar as:</p>
<blockquote>
<p>ArrayConstant(expr* args, ttype type, arraystorage storage_format)</p>
</blockquote>
<p>That means <code>ArrayConstant</code> was being used to handle both compiletime and runtime values. Thereafter we decided to split it into <code>ArrayConstructor</code> for handling runtime value and <code>ArrayConstant</code> which contains compiletime values.</p>
<p>Thus in <a href="https://github.com/lfortran/lfortran/pull/3579">PR#3579</a>, the grammar was changed to:</p>
<blockquote>
<p>ArrayConstructor(expr* args, ttype type, expr? value, arraystorage storage_format)
ArrayConstant(expr* args, ttype type, arraystorage storage_format)</p>
</blockquote>
<p>From then, <code>ArrayConstant</code> is only allowed other <code>*Constant</code> in it (but not another <code>ArrayConstant</code>) whereas the <code>ArrayConstructor</code> is allowed other nodes. For example <code>[sin(x), y]</code>, or two <code>ArrayConstants</code>.</p>
<p>Later, we realized that we should improve upon the internal representation of <code>ArrayConstant</code> further, so we documented approach at <a href="https://github.com/lfortran/lfortran/issues/3581">issue#3581</a>.</p>
<p>Now,<code>ArrayConstant</code> should contain a type (that includes kind) of the element, shape, and then a pointer to contiguous data. Thus the ASR grammar was changed to:</p>
<blockquote>
<p>ArrayConstant(int n_data, void data, ttype type, arraystorage storage_format)</p>
</blockquote>
<p>Implementation details can be found at <a href="https://github.com/lfortran/lfortran/pull/3859">PR#3859</a>.</p>
<p>There were also a bunch of minor patches that contributed to performance improvement for evaluating compile time values.</p>
<h2 id="contributing">Contributing</h2>
<p>Help us get to beta faster by reporting bugs and submitting PRs to fix things. We will help you get started, no prior compiler experience needed.</p>
<h2 id="acknowledgements">Acknowledgements</h2>
<p>We want to thank:</p>
<ul>
<li><a href="https://sovereigntechfund.de/en/">Sovereign Tech Fund (STF)</a></li>
<li><a href="https://numfocus.org/">NumFOCUS</a></li>
<li><a href="https://quantstack.net/">QuantStack</a></li>
<li><a href="https://summerofcode.withgoogle.com/">Google Summer of Code</a></li>
<li><a href="https://gsitechnology.com/">GSI Technology</a></li>
<li><a href="https://lanl.gov/">LANL</a></li>
<li>Our GitHub, OpenCollective and NumFOCUS sponsors</li>
<li>All our contributors (78 so far!)</li>
</ul>
<h2 id="discussions">Discussions</h2>
<ul>
<li>Fortran Discourse: <a href="https://fortran-lang.discourse.group/t/compile-time-computation-example-now-works-with-lfortran/8139">https://fortran-lang.discourse.group/t/compile-time-computation-example-now-works-with-lfortran/8139</a></li>
<li>Twitter: <a href="https://twitter.com/lfortranorg/status/1797999009849868783">https://twitter.com/lfortranorg/status/1797999009849868783</a></li>
<li>LinkedIn: <a href="https://www.linkedin.com/posts/pranavgoswami1_fortran-arrays-performance-activity-7203772703198052352-Q1RR/">https://www.linkedin.com/posts/pranavgoswami1_fortran-arrays-performance-activity-7203772703198052352-Q1RR/</a></li>
</ul>


        
          <div class="blog-tags">
            
              
              <a href="https://lfortran.org/tags/fortran/">Fortran</a>&nbsp;
            
              
              <a href="https://lfortran.org/tags/announcement/">Announcement</a>&nbsp;
            
              
              <a href="https://lfortran.org/tags/performance/">Performance</a>&nbsp;
            
              
              <a href="https://lfortran.org/tags/arrays/">Arrays</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://lfortran.org/blog/2024/05/fortran-on-web-using-lfortran/" data-toggle="tooltip" data-placement="top" title="Fortran On Web Using LFortran">&larr; Previous Post</a>
            </li>
          
          
            <li class="next">
              <a href="https://lfortran.org/blog/2024/07/lfortran-supports-openmp-pragmas-and-do-concurrent/" data-toggle="tooltip" data-placement="top" title="LFortran supports OpenMP pragmas and Do Concurrent">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      <footer>
  <div class="container">
    
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            2024
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://lfortran.org/">LFortran</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
           
          
        </p>
      </div>
    </div>
  </div>
</footer><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/katex.min.js" integrity="sha384-G0zcxDFp5LWZtDuRMnBkk3EphCK1lhEf4UEyEM693ka574TZGwo4IWwS6QLzM/2t" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>
<script src="https://code.jquery.com/jquery-3.7.0.slim.min.js" integrity="sha384-w5y/xIeYixWvfM+A1cEbmHPURnvyqmVg5eVENruEdDjcyRLUSNej7512JQGspFUr" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>

<script src="https://lfortran.org/js/main.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://lfortran.org/js/load-photoswipe.js"></script>










  </body>
</html>

